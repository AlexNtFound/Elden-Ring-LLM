<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player Profile</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
</head>
<!-- <body style="background-image: url(assets/img/bg1.webp); background-size: 110%; filter: drop-shadow(100px);"> -->
<body id="profile-bg-image">
    <!-- <div class="background-container" id="profile-bg-image">
        <div class="background-blur"></div>
    </div> -->
    <div class="sidebar">
        <img onclick="location.href='index.html'" src="./images/eldenringicon.png" alt="Sidebar Image" class="sidebar-image">
        <button onclick="location.href='llm.html'" class="search-button">
            <img src="./images/whitesearch.png" alt="Search Icon" class="search-icon">
        </button>
        <button class="active" onclick="location.href='profile.html'">Profile</button>
        <button onclick="location.href='weapons.html'">Weapons</button>
        <button onclick="location.href='metabuilds.html'">Meta Builds</button>
        <button onclick="location.href='armors.html'">Armors</button>
        <button onclick="location.href='talismans.html'">Talismans</button>
        <button onclick="location.href='incantations.html'">Incantations</button>
        <button onclick="location.href='magics.html'">Sorceries</button>
        <button onclick="location.href='spiritAshes.html'">Spirit Ashes</button>
        <button onclick="location.href='ashesOfWar.html'">Ashes of War</button>
    </div>
    <div class="main-content">
        <div class="title-container">
            <h2>Player Profile</h2>
            <h2 id="profile-details"></h2>
        </div>
        <div class="container">
            <div class="profile-occupied" >
                <img src="images/Hero.png" alt="Player 1" id="player-image">
                <p id="profile-name">Profile 1</p>
                <p id="profile-description"></p>
            </div>
            <div class="attributes-container">
                <p class="attributes-title">Loaded Attributes</p>
                <div class="attributes-section">
                    <div class="attributes">
                        <p>Level:</p>
                        <p>Runes Held:</p>
                        <p>Vigor:</p>
                        <p>Mind:</p>
                        <p>Endurance:</p>
                        <p>Strength:</p>
                        <p>Dexterity:</p>
                        <p>Intelligence:</p>
                        <p>Faith:</p>
                        <p>Arcane:</p>
                    </div>
                    <div class="loaded-attributes">
                        <p><span id="level"></span></p>
                        <p><span id="souls"></span></p>
                        <p><span id="Vigor"></span></p>
                        <p><span id="Mind"></span></p>
                        <p><span id="Endurance"></span></p>
                        <p><span id="Strength"></span></p>
                        <p><span id="Dexterity"></span></p>
                        <p><span id="Intelligence"></span></p>
                        <p><span id="Faith"></span></p>
                        <p><span id="Arcane"></span></p>
                    </div>
                </div>
            </div>
            <div class="actions" data-tilt data-tilt-startX="100" data-tilt-reset-to-start="true" data-tilt-axis="x">
                <button onclick="adviseAttributes()" id="suggest-weapons">Suggest Weapons</button>
                <button onclick="showMetaBuilds()" id="go-metabuilds">Show Meta-Builds</button>
            </div>
        </div>
    </div>

    <script src="assets/js/script.js"></script>
    <script type="text/javascript" src="vanilla-tilt.js"></script>
    <script type="text/javascript">
        VanillaTilt.init(document.querySelector(".profile-occupied"), {
            startX: -15,
            // startY: -20,
            scale: "1.15",
            reset_to_start: true,
            max: 25,
            speed: 400
        });
        
        //It also supports NodeList
        VanillaTilt.init(document.querySelectorAll(".your-element"));
    </script>
    <script>
        /*const player_class = localStorage.getItem("player_class");
        console.log("Player Class:", player_class);
        document.getElementById('player-image').src = `images/${player_class}.png`;
        */
        document.addEventListener('DOMContentLoaded', async () => {
            let profile_name = localStorage.getItem('profile_name');
            let load_json = JSON.parse(localStorage.getItem("save_json"));
            console.log("Loaded JSON:", JSON.stringify(load_json.owned.armament));
            // let armament_info = queryData(load_json, "owned.armament");
            // console.log("Armament Info:", armament_info);
            let json_response = queryData(load_json, "stats");
            // import fetch from 'node-fetch'; // for node.js
            const classResponse = await fetch(
            'https://noggin.rea.gent/daily-mandrill-3370',
            {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                Authorization: 'Bearer rg_v1_tikkosex4a85z1x5iy0yqx3hythmhjbxcdq0_ngk',
                },
                body: JSON.stringify({
                // fill variables here.
                "attributes": json_response,
                }),
            }
            ).then(classResponse => classResponse.text());
            const playerImage = document.getElementById('player-image');
            playerImage.src = `images/${classResponse}.png`;
            if (profile_name) {
                document.getElementById('profile-details').innerText = `Selected Profile: ${load_json.character}`;
                document.getElementById('profile-name').innerText = load_json.character;// import fetch from 'node-fetch'; // for node.js
                const des_response = await fetch(
                'https://noggin.rea.gent/frantic-felidae-1191',
                {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json',
                    Authorization: 'Bearer rg_v1_u6vl9116ws35x09fmqxx960ihavger2s8hzj_ngk',
                    },
                    body: JSON.stringify({
                    // fill variables here.
                    "attributes": queryData(load_json, "stats"),
                    }),
                }
                ).then(response => response.text());
                const typewriterElement = document.getElementById('profile-description');
                let index = 0;
                function typeWriter() {
                    if (index < des_response.length) {
                        typewriterElement.textContent += des_response.charAt(index);
                        index++;
                        setTimeout(typeWriter, 30); // Adjust the speed by changing the delay (in milliseconds)
                    }
                }
                typeWriter();
            } else {
                document.getElementById('profile-details').innerText = 'No profile selected.';
            }
    
            // let load_json = JSON.parse(localStorage.getItem("save_json"));
            try {
                const jsonObject = JSON.parse(json_response);
                console.log("Parsed JSON Object:", jsonObject);

                const attributes = [
                    { id: "level", value: jsonObject.level },
                    { id: "souls", value: jsonObject.souls },
                    { id: "Vigor", value: jsonObject.Vigor },
                    { id: "Mind", value: jsonObject.Mind },
                    { id: "Endurance", value: jsonObject.Endurance },
                    { id: "Strength", value: jsonObject.Strength },
                    { id: "Dexterity", value: jsonObject.Dexterity },
                    { id: "Intelligence", value: jsonObject.Intelligence },
                    { id: "Faith", value: jsonObject.Faith },
                    { id: "Arcane", value: jsonObject.Arcane }
                ];

                attributes.forEach(attr => {
                    const element = document.getElementById(attr.id);
                    element.innerText = attr.value;
                    element.classList.add('hidden');
                });

                attributes.forEach((attr, index) => {
                    setTimeout(() => {
                        const element = document.getElementById(attr.id);
                        element.classList.remove('hidden');
                        element.classList.add('fade-in');
                    }, index * 300); // Adjust the delay as needed
                });

            } catch (error) {
                console.error("Error parsing JSON:", error);
            }

            // import fetch from 'node-fetch'; // for node.js

            const weaponsResponse = await fetch(
            'https://noggin.rea.gent/amused-turtle-6511',
            {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                Authorization: 'Bearer rg_v1_hzhpa02lryativbyznfzmhzxbmjaxbkkan3p_ngk',
                },
                body: JSON.stringify({
                // fill variables here.
                "attributes": json_response,
                }),
            }
            ).then(weaponsResponse => weaponsResponse.text());
            const jsonObject = JSON.parse(weaponsResponse);
            for (const key in jsonObject) {
                if (jsonObject.hasOwnProperty(key)) {
                    localStorage.setItem(key, jsonObject[key]);
                }
            }

            // Verify that the data has been stored in local storage
            console.log(localStorage.getItem("weapon1")); // Outputs: Moonlight Greatsword
            console.log(localStorage.getItem("description1")); // Outputs: Radiant blade of magic, cuts through darkness with arcane power.
            console.log(localStorage.getItem("weapon2")); // Outputs: Frayed Blade
            console.log(localStorage.getItem("description2"));

            // import fetch from 'node-fetch'; // for node.js
            console.log("Owned Armament:", queryData(load_json, "owned.armament"));

            const weaponsResponse2 = await fetch(
            'https://noggin.rea.gent/greasy-toucan-3614',
            {
                method: 'POST',
                headers: {
                'Content-Type': 'application/json',
                Authorization: 'Bearer rg_v1_qa80x6wh3epy3stg5wnlmghr1zahcc90xx2i_ngk',
                },
                body: JSON.stringify({
                // fill variables here.
                "attributes": json_response,
                "owned": JSON.stringify(load_json.owned.armament),
                }),
            }
            ).then(weaponsResponse2 => weaponsResponse2.text());
            const jsonObject2 = JSON.parse(weaponsResponse2);
            for (const key in jsonObject2) {
                if (jsonObject2.hasOwnProperty(key)) {
                    localStorage.setItem(key, jsonObject2[key]);
                }
            }

            console.log(localStorage.getItem("owned_weapon1")); // Outputs: Moonlight Greatsword
            console.log(localStorage.getItem("owned_description1")); // Outputs: Radiant blade of magic, cuts through darkness with arcane power.
            console.log(localStorage.getItem("owned_weapon2")); // Outputs: Frayed Blade
            console.log(localStorage.getItem("owned_description2"));
        });
    
        function adviseAttributes() {
            window.location.href = 'weapons.html';
        }
    
        function showMetaBuilds() {
            window.location.href = 'metabuilds.html';
        }
    
        function queryData(json, entry_str) {
            console.log(entry_str);
            if (!entry_str.includes(";")) {
                if (isValidJSON(json[entry_str]) || !(json[entry_str] instanceof String)) {
                    return JSON.stringify(json[entry_str]);
                }
                return json[entry_str];
            }
            const entries = entry_str.split(';');
            return queryData(json[entries.shift()], entries.join(';'));
        }
    
        function isValidJSON(str) {
            try {
                JSON.parse(str);
                return true;
            } catch (e) {
                return false;
            }
        }
    </script>
</body>
</html>