<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Missed Spirit Ashes</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="patch.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
</head>
<!-- <body style="background-image: url(assets/img/bg1.webp); background-size: 110%; filter: drop-shadow(100px);"> -->
<body>
    <div class="sidebar">
        <img onclick="location.href='index.html'" src="./images/eldenringicon.webp" alt="Sidebar Image" class="sidebar-image">
        <button onclick="location.href='llm.html'" class="search-button">
            <img src="./images/whitesearch.png" alt="Search Icon" class="search-icon">
        </button>
        <button onclick="location.href='profile.html'">Profile</button>
        <button onclick="location.href='weapons.html'">Weapons</button>
        <button onclick="location.href='metabuilds.html'">Meta Builds</button>
        <button onclick="location.href='armors.html'">Armors</button>
        <button onclick="location.href='talismans.html'">Talismans</button>
        <button onclick="location.href='incantations.html'">Incantations</button>
        <button onclick="location.href='magics.html'">Sorceries</button>
        <button class="active" onclick="location.href='spiritAshes.html'">Spirit Ashes</button>
        <button onclick="location.href='ashesOfWar.html'">Ashes of War</button>
    </div>
    <div class="main-content">
        <div class="armor-title-container">
            <h2>Player's Missed Spirit Ashes</h2>
        </div>
        <div class="container">
            <div class="armor-container" style="display: flex; padding-top: 15%; width: 100%; height: 100vh; justify-content: space-evenly; flex-wrap: wrap; overflow-y: auto" id="armor-set"></div>
        </div>
    </div>
    <div style="display: flex; height: 10%; width:1%; justify-content: flex-end; padding-right: 10px;"><button class="sort-btn" onclick="sort()">SORT ALPHABETICALLY</button></div>
    <script>
        let r = Math.floor(Math.random() * 12);
        document.getElementsByTagName("body")[0].style.backgroundImage = `url(assets/img/bg${r}.webp`;
    </script>
    <script src="assets/js/script.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.4.0/dist/confetti.browser.min.js"></script>
    <script type="text/javascript" src="vanilla-tilt.js"></script>
    <script type="text/javascript">
        const load_json = JSON.parse(localStorage.getItem("save_json"));
        const not_owned_incantations = load_json["not-owned"]["spiritAshes"];
        console.log(not_owned_incantations);
        loadIncantions(not_owned_incantations);
    
        function loadIncantions(incantation_names) {    
            const incantation_container = document.querySelector("#armor-set");
            for (let idx = 0; idx < incantation_names.length; idx++) {
                const name = incantation_names[idx];
                const new_div = document.createElement("div");
                
                // too lazy to create a new CSS, just use armor-occupied
                new_div.className = "armor-occupied";
                new_div.innerHTML = `<p>${name}</p> <img src="assets/img/spiritAshes/${name}.webp" alt="${name}">`;
                VanillaTilt.init(new_div, {
                    startX: -15,
                    // startY: -20,
                    scale: "1.2",
                    reset_to_start: true,
                    max: 25,
                    speed: 400
                });
                new_div.addEventListener("click", ()=>{focus(name);});
                incantation_container.appendChild(new_div);
            }
        }
        
        const spirit_db = JSON.parse(localStorage.getItem("spirit_ash_json"));
        // console.log(spell_db);
        async function focus(talisman_name) {
            const containerDiv = document.querySelector(".container");
            document.querySelector("#armor-set").style.display = "none";
            const taliDiv = document.createElement("div");
            taliDiv.className = 'items-container';
            taliDiv.innerHTML = `<p style="font-weight:bold;">${talisman_name}</p>
                    <img src="assets/img/spiritAshes/${talisman_name}.webp" height=300px width=300px alt='${talisman_name}'>
                    <p style="color: #da7d20;">Click to Go Back</p>`;
            taliDiv.addEventListener("click", ()=> {window.location.href="spiritAshes.html";});
            taliDiv.style.width = "15%";
            containerDiv.appendChild(taliDiv);
    
            let desc = "Mysterious DLC Armor";
            if (talisman_name in spirit_db) {
                desc = spirit_db[talisman_name]["description"].join(" ");
            }
            
            async function getLoc() {
                let llm_loc =  await fetch(
                'https://noggin.rea.gent/quixotic-hippopotamus-8180',
                {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json',
                    Authorization: 'Bearer rg_v1_23875kejtov40kivlcwtsdqa2mmu5iz2y8bt_ngk',
                    },
                    body: JSON.stringify({
                    // fill variables here.
                    "item": "spirit ash: " + talisman_name,
                    }),
                }
                ).then(response => response.text());
                return llm_loc;
            }
    
            const descrDiv = document.createElement("div");
            descrDiv.style.width = "60%";
            descrDiv.className = "items-container";
            descrDiv.innerHTML = `<p class="items-title">LLM Spirit Ash</p>`;
    
            const sectionDiv = document.createElement("div");
            sectionDiv.className = "items-section";
    
            const attrDiv = document.createElement("div");
            attrDiv.className = "items";
            attrDiv.innerHTML = `<p>Spirit Ash Description:</p> <p>LLM Generated Location:</p>`;
            
            const loadDiv = document.createElement("div");
            loadDiv.className = "loaded-items";
            loadDiv.innerHTML = `<p><span>${desc}</span></p> <p><span>Loading Location</span></p>`;
            getLoc().then(loc => {
                const link_start = loc.indexOf('[');
                const link_end = loc.indexOf(']');
                const pureDes = loc.slice(0, link_start);
                const link = loc.slice(link_start + 1, link_end);
                loadDiv.innerHTML = `<p><span>${desc}</span></p> <p><span>${pureDes}<a href='${link}' target='_blank'>${link}</a></span></p>`;
            });
            sectionDiv.appendChild(attrDiv);
            sectionDiv.appendChild(loadDiv);
            descrDiv.appendChild(sectionDiv);
            containerDiv.appendChild(descrDiv);
        }
        function sort() {
            confetti({
            particleCount: 500,
            startVelocity:70, 
            gravity: 0.7, 
            angle: -135,
            spread: 90,
            origin: { y: 0.1, x:0.9 },
            colors: ['#f5d742'],
            scalar: 5
            });
            const talimsans_container = document.querySelector("#armor-set");
            if (talimsans_container.childElementCount != 0) {
                while(talimsans_container.firstChild) { 
                    talimsans_container.removeChild(talimsans_container.firstChild); 
                }
            } 
            not_owned_incantations.sort();
            loadIncantions(not_owned_incantations);
        }
    </script>
</body>
</html>