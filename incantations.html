<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Missed Incantations</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap" rel="stylesheet">
</head>
<!-- <body style="background-image: url(assets/img/bg1.webp); background-size: 110%; filter: drop-shadow(100px);"> -->
<body>
    <div class="sidebar">
        <img onclick="location.href='index.html'" src="./images/eldenringicon.webp" alt="Sidebar Image" class="sidebar-image">
        <button onclick="location.href='llm.html'" class="search-button">
            <img src="./images/whitesearch.png" alt="Search Icon" class="search-icon">
        </button>
        <button onclick="location.href='boss.html'">Bosses</button>
        <button onclick="location.href='achievements.html'">Achievements</button>
        <button onclick="location.href='weapons.html'">Weapons</button>
        <button onclick="location.href='profile.html'">Profile</button>
        <button onclick="location.href='metabuilds.html'">Meta Builds</button>
        <button onclick="location.href='armors.html'">Armors</button>
        <button onclick="location.href='talismans.html'">Talismans</button>
        <button class="active" onclick="location.href='incantations.html'">Incantations</button>
    </div>
    <div class="main-content">
        <div class="armor-title-container">
            <h2>Player's Missed Incantations</h2>
        </div>
        <div class="container">
            <div class="armor-container" style="display: flex; width: 100%; height: 95%; justify-content: space-evenly; flex-wrap: wrap" id="armor-set"></div>
        </div>
    </div>
    <script>
        let r = Math.floor(Math.random() * 12);
        document.getElementsByTagName("body")[0].style.backgroundImage = `url(assets/img/bg${r}.webp`;
    </script>
    <script src="assets/js/script.js"></script>
    <script type="text/javascript" src="vanilla-tilt.js"></script>
    <script type="text/javascript">
        const load_json = JSON.parse(localStorage.getItem("save_json"));
        const not_owned_incantations = load_json["not-owned"]["magic"]["Incantation"];
        console.log(not_owned_incantations);
        loadIncantions(not_owned_incantations);
    
        function loadIncantions(incantation_names) {    
            const incantation_container = document.querySelector("#armor-set");
            for (let idx = 0; idx < incantation_names.length; idx++) {
                const name = incantation_names[idx];
                const new_div = document.createElement("div");
                
                // too lazy to create a new CSS, just use armor-occupied
                new_div.className = "armor-occupied";
                new_div.innerHTML = `<p>${name}</p> <img src="assets/img/magic/${name}.webp" alt="${name}">`;
                VanillaTilt.init(new_div, {
                    startX: -15,
                    // startY: -20,
                    scale: "1.2",
                    reset_to_start: true,
                    max: 25,
                    speed: 400
                });
                new_div.addEventListener("click", ()=>{focus(name);});
                incantation_container.appendChild(new_div);
            }
        }
        
        const spell_db = JSON.parse(localStorage.getItem("spell_json"));
        // console.log(spell_db);
        async function focus(talisman_name) {
            const containerDiv = document.querySelector(".container");
            document.querySelector("#armor-set").style.display = "none";
            const taliDiv = document.createElement("div");
            taliDiv.className = 'attributes-container';
            taliDiv.innerHTML = `<p>${talisman_name}</p>
                    <img src="assets/img/magic/${talisman_name}.webp" height=300px width=300px alt='${talisman_name}'>`;
            taliDiv.addEventListener("click", ()=> {window.location.href="incantations.html";});
            containerDiv.appendChild(taliDiv);
    
            let desc = "Mysterious DLC Armor";
            if (talisman_name in spell_db) {
                desc = spell_db[talisman_name]["description"].join(" ");
            }
            
            async function getLoc() {
                let llm_loc =  await fetch(
                'https://noggin.rea.gent/quixotic-hippopotamus-8180',
                {
                    method: 'POST',
                    headers: {
                    'Content-Type': 'application/json',
                    Authorization: 'Bearer rg_v1_23875kejtov40kivlcwtsdqa2mmu5iz2y8bt_ngk',
                    },
                    body: JSON.stringify({
                    // fill variables here.
                    "item": "incantation: " + talisman_name,
                    }),
                }
                ).then(response => response.text());
                return llm_loc;
            }
    
            const descrDiv = document.createElement("div");
            descrDiv.style.width = "50%";
            descrDiv.className = "attributes-container";
            descrDiv.innerHTML = `<p class="attributes-title">LLM Incantation</p>`;
    
            const sectionDiv = document.createElement("div");
            sectionDiv.className = "attributes-section";
    
            const attrDiv = document.createElement("div");
            attrDiv.className = "attributes";
            attrDiv.innerHTML = `<p>Talisman Description:</p> <p>LLM Generated Location:</p>`;
            
            const loadDiv = document.createElement("div");
            loadDiv.className = "loaded-attributes";
            loadDiv.innerHTML = `<p><span>${desc}</span></p> <p><span>Loading Location</span></p>`;
            getLoc().then(loc => {
                loadDiv.innerHTML = `<p><span>${desc}</span></p> <p><span>${loc}</span></p>`;
            });
            sectionDiv.appendChild(attrDiv);
            sectionDiv.appendChild(loadDiv);
            descrDiv.appendChild(sectionDiv);
            containerDiv.appendChild(descrDiv);
        }
    </script>
</body>
</html>